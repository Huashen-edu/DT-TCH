$(function() {
	var tchupdateFrame = {};
    tchupdateFrame.wrapper = $('#wrapper');
    tchupdateFrame.wrapper.alert=$('#main_common_alert');
    
    // init
    tchupdateFrame.init = function() {
    	tchupdateFrame.wrapper.find('.intro').show();
        setTimeout(function() {
        	tchupdateFrame.wrapper.find('.intro').fadeOut(function() {
        		tchupdateFrame.showLogin();
            });
        }, 1500);
        // 画面初载入
       WXLoad(tchupdateFrame.wrapper.alert, null, true);
           
    
    tchupdateFrame.showLogin = function() {
    	tchupdateFrame.wrapper.removeClass('page-center');
    	tchupdateFrame.wrapper.find('#container').fadeIn(function() {
    	//	tchupdateFrame.eventBind();
        });
    };   
		
    tchupdateFrame.updatepw();
    
    };
    tchupdateFrame.updatepw = function(){
		
		var user_id = localStorage.getItem('TCH_id')
		var user_name=localStorage.getItem('TCH_user_name')
       // var user_id="100072";
        document.getElementById("user_name").value = user_name;
		

		$('#btnNext').on(BIND_EVENT_TYPE, function(){
			if(($('input[name=pass]').val() == "") || ($('input[name=repass]').val() == "")){
				commonAlert('有未填写项，信息不能为空', false , null, null);
				return;
			}else{
				if(($('input[name=pass]').val().length < 4) || ($('input[name=pass]').val().length < 4)){
					commonAlert('请输入4位数以上的密码', false , null, null);
					return;
				}

				if($('input[name=pass]').val() != $('input[name=repass]').val()){
					commonAlert('两次密码不一致', false , null, null);
					return;
				}


					var params = {
					  user_id : localStorage.getItem('TCH_id'),
						//	user_id : 100072,
						user_pw : $('input[name=pass]').val()
					};

					getAjaxPostData('tch/updatePw.do?', params , true, function(data){
						var response = data;

						if((response.resultcode == '0000') && (response.result !== null)){
							commonAlert('新密码设置成功<br>请重新登录。', false , function(){
								localStorage.setItem('logout','Y');
								window.location.href="authorize.html"; ;
							}, null);
						}else{
							commonAlert('处理失败！', false , null, null);
							return;
						}
					});
				
			}
		});
		
		
		
    };
    tchupdateFrame.init();
});