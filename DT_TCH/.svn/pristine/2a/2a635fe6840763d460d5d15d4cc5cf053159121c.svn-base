$(function() {
	tchSubTempFrame.qaAdd = {};
	

	
});
var student_id =null;
/* 根据班主任，获取学生列表 */
function getStudentlistByT(){
	/*if(!$(".T-L").hasClass("am-hide")){
		$(".T-L").addClass("am-hide");
	}
	$(".T-T").removeClass("am-hide");*/
	var para = {
			scid : localStorage.getItem('TCH_scid'),
			class_no : localStorage.getItem('TCH_class_no'),
			school_year : localStorage.getItem('TCH_school_year')
		};
	getAjaxPostData("/tch/getAddressBookStudentsList.do?", para, true, function(data){
		//var optshtml='';
		if (data.resultcode == '0000') {
			var user_id = localStorage.getItem('TCH_id');
			for (var i = 0; i < data.result.length; i++) {
				if(user_id != data.result[i].user_id){
					/*optshtml+='<li data-userid="'+data.result[i].user_id+'">'+data.result[i].user_name+'</li>';
					student_list_all.push({"user_id" : data.result[i].user_id});*/
					$("#selectStudentList").append( "<option value=\data.result[i].user_id\>"+data.result[i].user_name+"</option>" );
				}
			}
			//$("#selectwrapper ul").html(optshtml);
		} else {
			commonAlert('<strong>目录信息</strong><br />连接失败。', false,
					null, null); 
			return;
		}
	});
}

/*根据选择的学生，获取家长列表*/
function getMyClassStudentParentsList(obj){
	var reg_type = null;
	var para = {
			scid : localStorage.getItem('TCH_scid'),
			user_id:obj.options[obj.options.selectedIndex].value,
		    user_name:obj.options[obj.options.selectedIndex].innerHTML,
			class_no : localStorage.getItem('TCH_class_no'),
			school_year : localStorage.getItem('TCH_school_year')
		};
	getAjaxPostData("/tch/getAddressBookStudentsList.do?", para, true, function(data){
		//var optshtml='';
		if (data.resultcode == '0000') {
			/*var user_id = localStorage.getItem('TCH_id');
			for (var i = 0; i < data.result.length; i++) {
				if(user_id != data.result[i].user_id){
					optshtml+='<li data-userid="'+data.result[i].user_id+'">'+data.result[i].user_name+'</li>';
					student_list_all.push({"user_id" : data.result[i].user_id});
					$("#selectStudentList").append( "<option value=\data.result[i].user_id\>"+data.result[i].user_name+"</option>" );
				}
			}*/
			//$("#selectwrapper ul").html(optshtml);
			
			reg_type = data.result[i].reg_type;
			if(reg_type.indexof("D") > 0){
				$("#D").attr("disabled",false);//父亲框可编辑
			}else if(reg_type.indexof("M") > 0){
				$("#M").attr("disabled",false);//母亲框可编辑
			}else if(reg_type.indexof("E") > 0){
				$("#E").attr("disabled",false);//监护人框可编辑
			}
			
		} else {
			commonAlert('<strong>目录信息</strong><br />连接失败。', false,
					null, null); 
			return;
		}
	});
	
}
//显示教师的信息
function getQaUserInfo(){
	document.getElementById("list-cnt").innerHTML=localStorage.TCH_user_name;
	
}

//新建家长问答
function addTeacherQna(){
	var StudentList = null;
	var QaContext = null;
	var targetType = null;
	var D = document.getElementById('D');  //父亲复选框
	var M = document.getElementById('M');  //母亲复选框
	var E = document.getElementById('E');  //监护人复选框
	StudentList = document.getElementById("selectStudentList");
	QaContext = document.getElementById("Qa_content");
	if(StudentList.value==""){
		commonAlert('请选择学生！',false, null, null);
		return false;
	}
	if(QaContext.value==""){
		commonAlert('请输入内容！',false, null, null);
		return false;
	}
	if(!(D.checked | M.checked | E.checked)){
		commonAlert('请选择要提问的家长！',false, null, null);
		return false;
	}
	
	if(D.checked){
		targetType = targetType+"D";
	}
	if(M.checked){
		if(targetType == null){
			targetType = targetType+"M";
		}else{
			targetType = targetType+","+"M";
		}
	}
	if(E.checked){
		if(targetType == null){
			targetType = targetType+"E";
		}else{
			targetType = targetType+","+"E";
		}
	}
	
	commonAlert("确认提交吗？",true,function(){
		
		var paramData = {
				"scid" : localStorage.getItem('TCH_scid'),
				"user_id" : localStorage.getItem('TCH_id'),
				"student_id" : $("#selectStudentList").val(),
				"school_year" : localStorage.getItem('TCH_school_year'),
				"class_no" : localStorage.getItem('TCH_class_no'),
				"comment" : $("#Qa_content").val(),
				"value_user_type" : "T",
                "target_type" : targetType
			};	
		getAjaxPostData("/tch/addTeacherQna.do?", para, true, function(data){
			//var optshtml='';
			if (data.resultcode == '0000') {
				
				lockScreen();
				tchSubTempFrame.alert
				.find('.desc')
				.html(
						'添加成功！');
				tchSubTempFrame.alert.fadeIn();
				
			} else {
				commonAlert('添加失败', false,
						null, null); 
				return;
			}
		});	
		
	});
}
