
// 通知详细数据
$(function() {
	tchSubTempFrame.noticeView = {};
	tchSubTempFrame.noticeView.wrapper = $('#wrapper');

	// init
	tchSubTempFrame.noticeView.init = function(){
		tchSubTempFrame.noticeView.viewInit();
		//tchSubTempFrame.noticeView.eventBind();
		//tchSubTempFrame.noticeView.wrapper.attr('data-color' , localStorage.getObject('parentInfo').parent_type);
	}

	// view init
	tchSubTempFrame.noticeView.viewInit = function(){
		var params = {
			nid : cts_getParameter("key")
		}

		// 公告详细信息
		getAjaxPostData("getNoticeInfo.do?", params, true, function(data){
			if(data.resultcode == '0000'){
				console.info('info정보 : ',data);

				tchSubTempFrame.noticeView.wrapper.find('.view_title').text(data.result.title);									// 제목
				tchSubTempFrame.noticeView.wrapper.find('.view_writer').text('['+ data.result.speaker +']');						// 작성자
				tchSubTempFrame.noticeView.wrapper.find('.view_regDate').text((data.result.reg_date).toString().substring(0,16));	// 날짜


				var n_dom = '';
				// 老师
				if( (data.result.target) && (data.result.target).match('T')){
					n_dom += '<pt>[致老师的公告。]</pt>';
					n_dom += viewMemo(data.result.memo);
				}

				tchSubTempFrame.noticeView.wrapper.find('.cnt-contain .cnt').html(n_dom);						// 내용


				//附件
				if(data.result.fileList && data.result.fileList.length > 0){
					var fileListDom = $('<div class="file-download"></div>');
					
					//获取所有附件
					var are = [];
					data.result.fileList.forEach(function(file){
						if(file.filepath && !file.filepath.match("http://")){
							var urlAlarm = "" + lmsUrl.substring(0,(lmsUrl.length-1))+file.filepath + file.filename + "";
							are.push(urlAlarm );
						}else{
							var urlF = "" + file.filepath + file.filename + "";
							are.push(urlF);
						}
					});

					data.result.fileList.forEach(function(file){
						console.debug("file" , file);

						var f_dom = $('	<div><a href="'+ (file.filepath + file.filename) +'" class="dataType" rel="N">'+file.filename+'</a></div>');

						f_dom.click(function(e){
							e.preventDefault();
							var url = file.filepath;
							if(file.filepath && !file.filepath.match("http://")){
								url = lmsUrl+file.filepath;
							}
							
							if (typeof window.WeixinJSBridge != 'undefined') {
								WeixinJSBridge.invoke("imagePreview",{
									"urls" : are,
									"current" : ""+url + file.filename+""
								});
							}
						});

						fileListDom.append(f_dom);
					});

					tchSubTempFrame.noticeView.wrapper.find('.cnt-contain').append(fileListDom);
				}else{
					// 파일 없음
				}
			}else{
				commonAlert('处理失败', false , null, null);		//处理失败
				return;
			}
		});
	}

	tchSubTempFrame.noticeView.init();
});


