// 提醒详细数据
$(function() {
	tchSubTempFrame.alarmAdd = {};
	tchSubTempFrame.alarmAdd.wrapper = $('#wrapper');
	

	//添加附件
	function upLoad(){
	    $('#bnt_upload').on(BIND_EVENT_TYPE,function(){
	        $('#uploadInputFile').trigger('click');
	        $('#formUserID').attr('value',VALUE_USER_INFO.user_id);
	        $('#formUserID').val(VALUE_USER_INFO.user_id);
	    });
	}
	
	//确定按钮事件
	$('#submitBtn').on(BIND_EVENT_TYPE, submit );
	
	function submit(){
        var subjectId = $('#subjectList').val(),
            class_list = [],
            title = $('#alarmTitle').val(),
            alarm = $('#alarmTxt').val(),
            file_list = [],
            flieList = $('#upLoadFlieList p'),
            contents_id_list = [],
            contentsList = $('#upLoadContentListList .insert_file figure i'),
            classList = $('#selectClassList').find('a.select'),
			addressBookList = $('#addressBook-wrap');

        if(0 >= title.length)  {
            c_util.popupAdd('请输入标题。');
            return false
        }

        if(0 >= classList.length && VALUE_USER_TYPE == 'L')  {
            //반정보 입력
            c_util.popupAdd('请输入班级。');
            return false
        }

        if(0 >= alarm.length)  {
            //알림 내용을 작성해 주세요.
            c_util.popupAdd('请输入提醒内容。');
            return false
        }

		if(VALUE_USER_TYPE == 'T' && addressBookList.children().length == 0){
			//한명이상의 학생을 선택해주세요.
            c_util.popupAdd('请至少选择一名学生。');
            return false
		}

        c_util.popupCancel('确定结束提醒内容？' ,submitData);

        //서버에 전송 시작
        function submitData(){

            if(VALUE_USER_TYPE == 'L')  {
                //반 리스트 만들어줌
                for (var i = 0 ; i < classList.length; i++){
                    class_list.push( {"school_year" : classList[i].getAttribute('data-year') , "class_no" : classList[i].getAttribute('data-no') });
                }
            }

            //업로드파일 리스트 만들어줌
            for (var i = 0 ; i < flieList.length; i++){
                file_list.push({"file_path" : flieList[i].getAttribute('data-file')})
            }

            //컨텐츠 리스트 만들어줌
            /*for (var i = 0 ; i < flieList.length; i++){
                file_list.push({"file_path" : flieList[i].getAttribute('data-file')})
            }*/

			// 담임일때
			if(VALUE_USER_TYPE == "T"){
				var paramData = {
					"scid" : VALUE_USER_INFO.scid,
					"user_id" : VALUE_USER_INFO.user_id,
					"school_year" : VALUE_USER_INFO.school_year,
					"class_no" : VALUE_USER_INFO.class_no,
					"title" : title,
					"memo" : alarm,
					"file_list" : file_list,
					"contents_id_list" : contents_id_list,
					"student_list" : addressBookIdList
				},
				serverData = c_util.getAjaxData(VALUE_URL.addAlarmMyClass , 'POST' , paramData);
			}else{
				// 과목쌤일때
				var paramData = {
                    "user_id" : VALUE_USER_INFO.user_id ,
                    "subject_id": subjectId ,
                    "title": title ,
                    "memo":  alarm ,
                    "class_list": class_list ,
                    "file_list" : file_list ,
                    "value_user_type" : VALUE_USER_TYPE ,
                    "contents_id_list": contents_id_list
                },
                serverData = c_util.getAjaxData(VALUE_URL.addAlarm , 'POST' , paramData);		
				
			}
      

            if(0 < serverData){
                var pjaxOpt = { pname: 'P_07_02'};
                $.pjax({url: '/pages/board/provision_list.html', container: '#sub_page' , data: pjaxOpt});
            } else {
                //전송 실패
                c_util.popupAdd('传送失败。');
            }
        }
    }
	
	
});


