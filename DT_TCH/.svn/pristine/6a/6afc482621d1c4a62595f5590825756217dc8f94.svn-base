
$(function() {
	var tchSubTempFrame = {};
	tchSubTempFrame.user_info =$('#wrapper');
	tchSubTempFrame.user_info.user_infoWrap = $('.pr_edit');
	tchSubTempFrame.user_info.alert = $('#main_common_alert');
	// init
	tchSubTempFrame.user_info.init = function(){
		//$('.ctContainer').attr('data-type','user_info');
		// 初始信息 set
		tchSubTempFrame.user_info.infoSet();

		// event bind
		tchSubTempFrame.user_info.eventBind();
		
		tchSubTempFrame.user_info.find('.intro').show();
        setTimeout(function() {
        	tchSubTempFrame.user_info.find('.intro').fadeOut(function() {
        		tchSubTempFrame.showLogin();
            });
        }, 1500);
        // 画面初载入
        WXLoad(tchSubTempFrame.user_info.alert, null, true);
	}
	
	tchSubTempFrame.showLogin = function() {
		tchSubTempFrame.user_info.removeClass('page-center');
		tchSubTempFrame.user_info.find('#container').fadeIn(function() {
    		// event bind
    		tchSubTempFrame.user_info.eventBind();
        });
    }
	// 정보 setting
	tchSubTempFrame.user_info.infoSet = function(){
		
		/*var params = {
			user_id : '100007'
		};*/
		
		if(cts_getParameter("user_id")!=""){
			var params = {
					  user_id : cts_getParameter("user_id")
			};
		}else{
			var params = {
					  user_id : localStorage.getItem('TCH_id'),
						//	user_id : 100072,
					  scid : localStorage.getItem('TCH_scid'),
					  /*school_year_list : localStorage.getItemS('TCH_school_year_list'),
					  teacher_subject_list : localStorage.getItem('TCH_teacher_subject_list'),*/
			};
		}
		
		getAjaxPostData('/tch/getUserPersInfo.do?', params , true, function(data){
			//debugger;
			console.log(data);
			var response = data;
			console.log(response.result.user_id);
			if(response.resultcode == '0000'){
				debugger;
				tchSubTempFrame.user_info.user_infoWrap.find('.edit_user_id').text(response.result.user_id);
				tchSubTempFrame.user_info.user_infoWrap.find('.edit_user_national').text(response.result.national_name);
				tchSubTempFrame.user_info.user_infoWrap.find('.edit_user_originate').text(response.result.originate_name);
				tchSubTempFrame.user_info.user_infoWrap.find('.edit_user_birthday').text(response.result.birthday);
				
				tchSubTempFrame.user_info.user_infoWrap.find('.edit_user_subject').text(response.result.subject_name);
				if(response.result.school_year!=""&&response.result.class_no!=""){
					tchSubTempFrame.user_info.user_infoWrap.find('.edit_user_class').text(response.result.school_year+'-'+response.result.class_no);
				}
				tchSubTempFrame.user_info.user_infoWrap.find('.edit_user_sex').text(response.result.sex_name);
				

				tchSubTempFrame.user_info.user_infoWrap.find('.address').val(response.result.address);
				tchSubTempFrame.user_info.user_infoWrap.find('.phone01').val(response.result.phone);	
				tchSubTempFrame.user_info.user_infoWrap.find('.email01').val(response.result.user_email);									// 이메일1
				tchSubTempFrame.user_info.user_infoWrap.find('.control1').val(response.result.sns);
				
				tchSubTempFrame.user_info.user_infoWrap.find('.edit_user_teacher_year').text(response.result.teacher_year);
				tchSubTempFrame.user_info.user_infoWrap.find('.edit_user_teacher_position').text(response.result.teacher_position_name);
				tchSubTempFrame.user_info.user_infoWrap.find('.edit_user_teacher_duty').text(response.result.teacher_duty_name);
				
				//debugger;
			}else{
				commonAlert('用户信息连接失败。', false , null, null);		// 사용자 정보를<br />불러오지 못했습니다.
				return;
			}
		});
	}

	// event bind
	tchSubTempFrame.user_info.eventBind = function(){
		// input 标记焦点 content 区域 padding-bottom 添加
		tchSubTempFrame.user_info.user_infoWrap.find('input').focusin(function(){
			keyboardScrollSet($(this) , "on", $('#content_container'));
		});

		// input 标记焦点出局 content 区域 padding-bottom 删除值
		tchSubTempFrame.user_info.user_infoWrap.find('input').focusout(function(){
			keyboardScrollSet($(this) , "off", $('#content_container'));
		});

		// 个人信息修改完毕
		tchSubTempFrame.user_info.user_infoWrap.find('.btn_edit_teacher').on(BIND_EVENT_TYPE,function(){
			
			// 检查电子邮件形式的代码
			//emojiCheck(tchSubTempFrame.user_info.user_infoWrap.find('.email01').val(), function(){
				// 电子邮件格式
				var user_email = tchSubTempFrame.user_info.user_infoWrap.find('.email01').val();
				if(emailCheck(user_email)){
					//var user_email = tchSubTempFrame.user_info.user_infoWrap.find('.email01').val();
					tchSubTempFrame.user_info.user_infoWrap.find('input[name=user_email]').val(user_email);
				}else{
					alert('请正确输入邮箱地址！');
					//commonAlert('请正确输入<br/><strong>邮箱地址</strong>。', false , null, null);
					return;;
				}
			//});

			// 联系人代码
			//emojiCheck(tchSubTempFrame.user_info.user_infoWrap.find('.phone01').val(), function(){
				// 联系方式
				var teacher_phone = tchSubTempFrame.user_info.user_infoWrap.find('.phone01').val();
				if (phoneCheck(teacher_phone)) {
					tchSubTempFrame.user_info.user_infoWrap.find('input[name=phone]').val(teacher_phone);
				} else{
					alert('请正确输入联系方式！');
					//commonAlert('请正确输入<br/><strong>联系方式</strong>。', false , null, null);
					return;
				};
			//});
			
			var params = {
				user_id : localStorage.getItem('TCH_id'),
				address : tchSubTempFrame.user_info.user_infoWrap.find('.address').val(),
				phone : tchSubTempFrame.user_info.user_infoWrap.find('.phone01').val(),
				qq : tchSubTempFrame.user_info.user_infoWrap.find('.control1').val(),
				user_email : tchSubTempFrame.user_info.user_infoWrap.find('.email01').val()
			};
			//var params = $('#fmEdit').serialize();
			debugger;
			console.log(params);
			debugger;
			getAjaxPostData('/tch/updateTeacher.do?', params , false, function(data){
				var response = data;

				if(response.resultcode == '0000'){
					console.log('成功!');
					debugger;
				}else{
					commonAlert('处理失败。', false , null, null);		//处理失败
					return;
				}
			});
		});
	}
	
	
	
	tchSubTempFrame.user_info.init();
});